# ===== 基本设置 =====
server-name smartdns

# 服务器绑定配置
# 国内组 (china) 绑定 UDP 和 DoT 端口
bind :6053 -group china -no-speed-check -no-dualstack-selection
bind-tls :6055 -group china -no-speed-check -no-dualstack-selection
bind-https :6057 -group china -no-speed-check -no-dualstack-selection

# 海外组 (oversea) 绑定 UDP, DoT 和 DoH 端口
bind :7053 -group oversea -no-speed-check -no-dualstack-selection
bind-tls :7055 -group oversea -no-speed-check -no-dualstack-selection
bind-https :7057 -group oversea -no-speed-check -no-dualstack-selection

# ===== 日志配置 =====
log-level debug
log-size 128K
log-num 1
log-file /tmp/smartdns.log  

# ===== 缓存配置 =====
cache-size 2048
cache-persist no  
cache-checkpoint-time 60
cache-checkpoint-time 3600
rr-ttl-min 300
rr-ttl-max 86400

# ===== 证书配置 =====
ca-file /etc/ssl/certs/ca-certificates.crt
ca-path /etc/ssl/certs/

# ===== DNS 处理策略 =====
serve-expired yes
prefetch-domain no
force-AAAA-SOA yes
force-qtype-SOA 65
dualstack-ip-selection no
dnsmasq-lease-file /dev/null
response-mode first-ping  

# ===== 防污染加固 =====
bogus-nxdomain 0.0.0.0/8
bogus-nxdomain 10.0.0.0/8
bogus-nxdomain 172.16.0.0/12
bogus-nxdomain 192.168.0.0/16
bogus-nxdomain 169.254.0.0/16
ip-set -name cloudflare-ipv4 -file /etc/smartdns/cloudflare-ipv4.txt

# ===== 域名规则 =====
# conf-file /etc/smartdns/conf.d/anti-ad-smartdns.conf
conf-file /etc/smartdns/domain-set/domains.china.smartdns.conf
conf-file /etc/smartdns/domain-set/proxy-domain-list.conf
hosts-file /etc/hosts

# 本地域名规则
domain-rules /lan/ -address #
domain-rules /local/ -address #

# 默认规则
domain-rules -c /./ -group china

# 本地网络解析
address /router.lan/192.168.3.2

# 屏蔽无效查询
address /wpad.lan/#
address /invalid/#
address #6

# 引导DNS
server-tls 119.29.29.29:853 -bootstrap-dns -exclude-default-group
# ===== 代理配置 =====
proxy-server socks5://127.0.0.1:7898 -name socks5

# ===== 海外 DNS 组 =====
server-tls 1.1.1.1:853 -spki-pin SPfg6FluPIlUc6a5h313BDCxQYNGX+THTy7ig5X3+VA= -group oversea -proxy socks5 
server-tls 9.9.9.9:853 -spki-pin WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18= -group oversea -proxy socks5
server-tls 1.0.0.1:853 -spki-pin SPfg6FluPIlUc6a5h313BDCxQYNGX+THTy7ig5X3+VA= -group oversea -proxy socks5
server-tls 8.8.8.8:853 -spki-pin FqTJ9EDN0dfkPCn9lqFb4ow08ePpSXqKDRMcqJ7sM0k= -group oversea -proxy socks5
server-https https://dns.google/dns-query -spki-pin FqTJ9EDN0dfkPCn9lqFb4ow08ePpSXqKDRMcqJ7sM0k= -group oversea -proxy socks5
nameserver /cloudflare-dns.com/bootstrap
server-https https://cloudflare-dns.com/dns-query -spki-pin SPfg6FluPIlUc6a5h313BDCxQYNGX+THTy7ig5X3+VA= -group oversea -proxy socks5
# server-tcp 8.8.8.8:53 -group oversea -proxy socks5

# ===== 国内 DNS 组 =====
server-https https://223.5.5.5/dns-query -spki-pin pa14rFR/bBJ25OSjCswaXu6YKWgQ2BDY5jhRRicqeik= -group china -exclude-default-group
server-tls dot.360.cn:853 -spki-pin i9WtbILFhlaOnx0OLF9BCBZ2Wr1tisRc1YGmLHAAjQA= -group china -exclude-default-group 
server-tls 120.53.53.53:853 -spki-pin 5TIMjgyMhA0qmPdK+AM9LX6vNI/9EPBydh/ZXdfcYmI= -group china -exclude-default-group
